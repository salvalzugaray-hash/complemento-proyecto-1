<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flujo Interactivo: Instalaci√≥n de Aberturas RPT+DVH</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Chosen Palette: Slate (Neutral) + Emerald (Success) + Amber (Warning/Decision) + Rose (Error) + Blue (Process) -->
    <!-- Application Structure Plan: Vertical Process Map for clarity, a Decision Simulator to handle the branching logic interactively, and a Dashboard for metrics related to the quality gates. This structure is superior to the linear report for teaching the criticality of checks and the costs of failure, encouraging active exploration of the four key decision nodes. -->
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        
        /* Chart Container Styling as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width to prevent excessive stretching */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .flow-node {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .flow-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .flow-diamond {
            transform: rotate(-45deg);
            width: 8rem;
            height: 8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            cursor: pointer;
        }
        .flow-diamond-text {
            transform: rotate(45deg);
            text-align: center;
            padding: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .active-node {
            ring: 4px solid #3b82f6;
            background-color: #eff6ff !important;
        }
    </style>
    
    <!-- Visualization & Content Choices: Clickable HTML nodes for the flow, designed as a vertical, interactive map. JS state machine for the decision simulator to enforce branching logic. Bar Chart (Cost of Failure - Materials vs Execution vs Post) and Line Chart (Improvement Trend in Leakage Rate) using Chart.js to visualize the effectiveness of the process controls. Confirmed: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header Section -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-slate-900 tracking-tight">Proceso de Instalaci√≥n RPT + DVH</h1>
                <p class="text-sm text-slate-500">Flujo de Trabajo Detallado con Controles de Calidad</p>
            </div>
            <div class="hidden md:block">
                <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200">Basado en Simbolog√≠a ISO 5807</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- Intro Section -->
        <section class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-bold text-slate-800 mb-4">Arquitectura del Proceso de Calidad</h2>
            <p class="text-lg text-slate-600 leading-relaxed">
                Este panel interactivo transforma el diagrama de flujo t√©cnico en una gu√≠a paso a paso. La instalaci√≥n de Aberturas con Ruptura de Puente T√©rmico (RPT) y Doble Vidriado Herm√©tico (DVH) requiere controles rigurosos. Aqu√≠ puede explorar cada actividad, entender los <strong>Puntos de Decisi√≥n Cr√≠tica</strong> y simular la reacci√≥n del equipo ante una no conformidad.
            </p>
        </section>

        <!-- Main Content Grid: Flowchart on Left, Details/Simulator on Right (on desktop) -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- COLUMN 1 & 2: INTERACTIVE FLOW MAP -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 p-6 md:p-8">
                <h3 class="text-xl font-bold text-slate-800 mb-6 border-b border-slate-100 pb-2">1. Mapa de Flujo de Instalaci√≥n</h3>
                
                <div id="flow-container" class="space-y-4">
                    <!-- Step 0: INICIO -->
                    <div id="node-0" onclick="showDetail(0)" class="flow-node bg-blue-50 border border-blue-200 p-3 rounded-full text-center font-bold text-blue-800 w-32 mx-auto">
                        INICIO
                    </div>

                    <!-- Step 1: Recepci√≥n de Materiales -->
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    <div id="node-1" onclick="showDetail(1)" class="flow-node bg-blue-100 border-l-4 border-blue-600 p-4 rounded text-center max-w-sm mx-auto">
                        Recepci√≥n y verificaci√≥n de materiales
                    </div>

                    <!-- DECISION 1: ¬øConformes? -->
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    <div id="node-D1" onclick="showDetail('D1')" class="flow-diamond bg-amber-200 border-2 border-amber-500 shadow-md">
                        <div class="flow-diamond-text text-amber-900">¬øMateriales Conformes?</div>
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    
                    <!-- Loop for NO Conformidad (Visual Indicator) -->
                    <div id="no-conformidad-material-path" class="text-xs text-rose-600 font-bold text-center border-b border-rose-400 border-dashed pb-2 -mt-4 mb-4">
                        ‚Üô NO: Registrar NC & Notificar Proveedor (Vuelve a Recepci√≥n)
                    </div>

                    <!-- Step 2: Preparaci√≥n del vano -->
                    <div id="node-2" onclick="showDetail(2)" class="flow-node bg-blue-100 border-l-4 border-blue-600 p-4 rounded text-center max-w-sm mx-auto">
                        Preparaci√≥n del vano (S√ç a D1)
                    </div>

                    <!-- DECISION 2: ¬øVano en condiciones? -->
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    <div id="node-D2" onclick="showDetail('D2')" class="flow-diamond bg-amber-200 border-2 border-amber-500 shadow-md">
                        <div class="flow-diamond-text text-amber-900">¬øVano en condiciones?</div>
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Loop for NO Vano (Visual Indicator) -->
                    <div id="no-vano-path" class="text-xs text-rose-600 font-bold text-center border-b border-rose-400 border-dashed pb-2 -mt-4 mb-4">
                        ‚Üô NO: Reparar soporte (Vuelve a ¬øVano en condiciones?)
                    </div>
                    
                    <!-- Step 3: Instalaci√≥n premarco -->
                    <div id="node-3" onclick="showDetail(3)" class="flow-node bg-emerald-100 border-l-4 border-emerald-600 p-4 rounded text-center max-w-sm mx-auto">
                        Instalaci√≥n de premarco (si aplica) (S√ç a D2)
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    
                    <!-- Step 4: Colocaci√≥n de abertura RPT+DVH -->
                    <div id="node-4" onclick="showDetail(4)" class="flow-node bg-emerald-100 border-l-4 border-emerald-600 p-4 rounded text-center max-w-sm mx-auto">
                        Colocaci√≥n de abertura RPT+DVH
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 5: Nivelaci√≥n y fijaci√≥n -->
                    <div id="node-5" onclick="showDetail(5)" class="flow-node bg-emerald-100 border-l-4 border-emerald-600 p-4 rounded text-center max-w-sm mx-auto">
                        Nivelaci√≥n y fijaci√≥n mec√°nica
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 6: Sellado perimetral -->
                    <div id="node-6" onclick="showDetail(6)" class="flow-node bg-emerald-100 border-l-4 border-emerald-600 p-4 rounded text-center max-w-sm mx-auto">
                        Sellado perimetral (espuma + sellador)
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 7: Prueba de estanqueidad -->
                    <div id="node-7" onclick="showDetail(7)" class="flow-node bg-purple-100 border-l-4 border-purple-600 p-4 rounded text-center max-w-sm mx-auto">
                        Prueba de estanqueidad (simulaci√≥n de lluvia)
                    </div>

                    <!-- DECISION 3: ¬øPasa la prueba? -->
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    <div id="node-D3" onclick="showDetail('D3')" class="flow-diamond bg-amber-200 border-2 border-amber-500 shadow-md">
                        <div class="flow-diamond-text text-amber-900">¬øPasa la prueba?</div>
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    
                    <!-- Loop for NO Pasa la prueba (Visual Indicator) -->
                    <div id="no-estanqueidad-path" class="text-xs text-rose-600 font-bold text-center border-b border-rose-400 border-dashed pb-2 -mt-4 mb-4">
                        ‚Üô NO: Corregir filtraciones (Vuelve a Prueba de estanqueidad)
                    </div>

                    <!-- Step 8: Limpieza final y entrega -->
                    <div id="node-8" onclick="showDetail(8)" class="flow-node bg-emerald-100 border-l-4 border-emerald-600 p-4 rounded text-center max-w-sm mx-auto">
                        Limpieza final y entrega (S√ç a D3)
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 9: Verificaci√≥n post-instalaci√≥n -->
                    <div id="node-9" onclick="showDetail(9)" class="flow-node bg-purple-100 border-l-4 border-purple-600 p-4 rounded text-center max-w-sm mx-auto">
                        Verificaci√≥n post-instalaci√≥n (72 h)
                    </div>

                    <!-- DECISION 4: ¬øConforme a especificaciones? -->
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    <div id="node-D4" onclick="showDetail('D4')" class="flow-diamond bg-amber-200 border-2 border-amber-500 shadow-md">
                        <div class="flow-diamond-text text-amber-900">¬øConforme a especificaciones?</div>
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>
                    
                    <!-- Loop for NO Conformidad (Visual Indicator) -->
                    <div id="no-especificaciones-path" class="text-xs text-rose-600 font-bold text-center border-b border-rose-400 border-dashed pb-2 -mt-4 mb-4">
                        ‚Üô NO: Acci√≥n correctiva (Vuelve a Lecciones Aprendidas)
                    </div>

                    <!-- Step 10: Registrar en planilla de control -->
                    <div id="node-10" onclick="showDetail(10)" class="flow-node bg-teal-100 border-l-4 border-teal-600 p-4 rounded text-center max-w-sm mx-auto">
                        Registrar en planilla de control (S√ç a D4)
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 11: Lecciones aprendidas -->
                    <div id="node-11" onclick="showDetail(11)" class="flow-node bg-teal-200 border-4 border-teal-600 p-4 rounded text-center max-w-sm mx-auto">
                        Lecciones aprendidas ‚Üí Mejora continua
                    </div>
                    <div class="h-6 w-0.5 bg-slate-300 mx-auto"></div>

                    <!-- Step 12: FIN -->
                    <div id="node-12" onclick="showDetail(12)" class="flow-node bg-slate-200 border border-slate-400 p-3 rounded-full text-center font-bold text-slate-800 w-32 mx-auto">
                        FIN
                    </div>
                </div>

            </div>
            
            <!-- COLUMN 3: DYNAMIC DETAIL SIDEBAR / SIMULATOR -->
            <div class="lg:col-span-1 space-y-8 sticky top-20 h-full">
                
                <!-- Detail Panel -->
                <div id="detail-panel" class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 transition-all duration-300">
                    <h4 id="detail-title" class="text-xl font-bold text-slate-900 mb-2">Seleccione un Paso</h4>
                    <p id="detail-desc" class="text-slate-600 mb-4">Haga clic en cualquier actividad o rombo de decisi√≥n en el mapa para ver su descripci√≥n detallada, prop√≥sito y simbolog√≠a.</p>
                    <div class="text-sm font-semibold text-slate-700">Tipo de Control:</div>
                    <div id="detail-extra" class="text-sm bg-slate-100 p-3 rounded border border-slate-200 text-slate-500 font-mono mt-1">Simbolog√≠a ISO 5807</div>
                </div>

                <!-- Simulator Console -->
                 <div class="bg-slate-900 rounded-xl shadow-lg p-6 flex flex-col">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-2xl text-amber-400">üö®</span> Consola de Decisiones
                    </h3>
                    <p class="text-slate-400 text-sm mb-4">
                        Simule el flujo tomando decisiones en los puntos cr√≠ticos (rombo). La consola le guiar√° a trav√©s de los bucles de correcci√≥n.
                    </p>
                    
                    <div class="flex-grow bg-slate-800 rounded-lg p-3 font-mono text-xs text-green-400 overflow-y-auto h-36 mb-4 shadow-inner" id="sim-console">
                        <div class="text-slate-500 border-b border-slate-700 pb-1 mb-2">Simulador cargado.</div>
                        <div class="mb-1 text-slate-300">> Presione 'Iniciar Flujo' para empezar la simulaci√≥n.</div>
                    </div>

                    <div class="grid grid-cols-3 gap-3" id="sim-controls">
                        <button onclick="startSimulation()" id="btn-start" class="col-span-3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            Iniciar Flujo
                        </button>
                        <!-- Decision buttons (hidden initially) -->
                        <button id="btn-yes" onclick="simDecision(true)" class="hidden col-span-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            S√ç
                        </button>
                        <button id="btn-no" onclick="simDecision(false)" class="hidden col-span-2 bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            NO / Corregir
                        </button>
                    </div>
                </div>

            </div>
        </section>

        <!-- SECTION 3: PERFORMANCE DASHBOARD -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 md:p-8">
            <h3 class="text-xl font-bold text-slate-800 mb-4 border-b border-slate-100 pb-2">3. Impacto de Calidad (M√©tricas Clave)</h3>
            <p class="text-slate-600 mb-6">
                El valor de un flujo de trabajo riguroso se mide en la reducci√≥n de costos y tiempos. Estos gr√°ficos visualizan datos hipot√©ticos 
                relacionados con los principales puntos de fallo, demostrando por qu√© la prevenci√≥n temprana es vital.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Chart 1: Costos de No Calidad -->
                <div class="flex flex-col">
                    <h4 class="text-sm font-semibold text-slate-700 mb-4 text-center">Costo de la No Calidad (Por Tipo de Falla)</h4>
                    <div class="chart-container">
                        <canvas id="costChart"></canvas>
                    </div>
                    <p class="text-xs text-slate-400 mt-2 text-center">Un fallo detectado tarde es m√°s caro. Los fallos Post-Instalaci√≥n (72h) tienen el mayor impacto.</p>
                </div>

                <!-- Chart 2: Mejora Continua -->
                <div class="flex flex-col">
                    <h4 class="text-sm font-semibold text-slate-700 mb-4 text-center">Tasa de Filtraciones en Prueba de Estanqueidad (Tendencia)</h4>
                    <div class="chart-container">
                        <canvas id="leakageTrendChart"></canvas>
                    </div>
                    <p class="text-xs text-slate-400 mt-2 text-center">La "Mejora Continua" busca reducir esta tasa al integrar las lecciones aprendidas sobre sellados.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-300 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm">
            <p>Aplicaci√≥n generada para la gesti√≥n y visualizaci√≥n de procesos t√©cnicos de calidad.</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & STATE MANAGEMENT ---
        
        const flowSteps = {
            0: { title: "INICIO", desc: "El proceso se pone en marcha. Se disponen los planos y especificaciones.", extra: "Simbolog√≠a: Terminal (√ìvalo)" },
            1: { title: "Recepci√≥n y verificaci√≥n de materiales", desc: "El inspector de calidad coteja los materiales RPT y DVH contra la orden de compra y las especificaciones t√©cnicas (ej: control visual de RPT, dimensiones de DVH).", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            'D1': { title: "¬øMateriales Conformes?", desc: "Punto de control cr√≠tico. ¬øEl material cumple con calidad, cantidad y especificaciones? Si es NO, se genera una No Conformidad formal.", extra: "Simbolog√≠a: Decisi√≥n (Rombo)" },
            2: { title: "Preparaci√≥n del vano", desc: "Verificaci√≥n de que el hueco estructural (vano) est√© limpio, nivelado y tenga el aplomo correcto, seg√∫n tolerancias de instalaci√≥n.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            'D2': { title: "¬øVano en condiciones?", desc: "Punto de control intermedio. La verificaci√≥n del vano puede evitar problemas graves de estanqueidad y funcionalidad despu√©s de la colocaci√≥n.", extra: "Simbolog√≠a: Decisi√≥n (Rombo)" },
            3: { title: "Instalaci√≥n de premarco (si aplica)", desc: "Colocaci√≥n y fijaci√≥n del premarco, asegurando su nivelaci√≥n y aplomo antes de recibir la abertura final.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            4: { title: "Colocaci√≥n de abertura RPT+DVH", desc: "Introducci√≥n de la abertura en el vano o premarco, centrado para el correcto sellado posterior.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            5: { title: "Nivelaci√≥n y fijaci√≥n mec√°nica", desc: "Aseguramiento temporal y luego definitivo de la abertura al soporte, garantizando su perfecta operaci√≥n.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            6: { title: "Sellado perimetral", desc: "Aplicaci√≥n de espuma de poliuretano y sellador el√°stico para asegurar la aislaci√≥n t√©rmica e h√≠drica (punto cr√≠tico de RPT).", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            7: { title: "Prueba de estanqueidad", desc: "Simulaci√≥n de lluvia o test de presi√≥n para verificar la resistencia a filtraciones de aire y agua.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            'D3': { title: "¬øPasa la prueba?", desc: "Punto de control de desempe√±o crucial. Si es NO, requiere correcci√≥n inmediata del sellado o la fijaci√≥n.", extra: "Simbolog√≠a: Decisi√≥n (Rombo)" },
            8: { title: "Limpieza final y entrega", desc: "Remoci√≥n de residuos, protecci√≥n de perfiles y entrega formal al cliente o encargado de obra.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            9: { title: "Verificaci√≥n post-instalaci√≥n (72 h)", desc: "Inspecci√≥n final despu√©s de un per√≠odo de asentamiento para verificar la funcionalidad y el sellado.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo)" },
            'D4': { title: "¬øConforme a especificaciones?", desc: "√öltimo punto de control de calidad. Si es NO, se activa la Acci√≥n Correctiva y la retroalimentaci√≥n al proceso.", extra: "Simbolog√≠a: Decisi√≥n (Rombo)" },
            10: { title: "Registrar en planilla de control", desc: "Documentaci√≥n formal de la finalizaci√≥n del proceso y la conformidad del producto.", extra: "Simbolog√≠a: Documento (Rect√°ngulo con doble base, en uso conceptual)" },
            11: { title: "Lecciones aprendidas ‚Üí Mejora continua", desc: "An√°lisis de todas las No Conformidades y Acciones Correctivas para actualizar los procedimientos y prevenir fallos futuros.", extra: "Simbolog√≠a: Actividad (Rect√°ngulo, Bucle de Mejora)" },
            12: { title: "FIN", desc: "El proceso ha terminado exitosamente.", extra: "Simbolog√≠a: Terminal (√ìvalo)" }
        };

        // --- INTERACTIVITY FUNCTIONS (Flowchart Detail) ---

        function showDetail(id) {
            const nodes = document.querySelectorAll('.flow-node, .flow-diamond');
            nodes.forEach(n => n.classList.remove('active-node'));

            const nodeElement = document.getElementById(`node-${id}`);
            if (nodeElement) nodeElement.classList.add('active-node');

            const data = flowSteps[id];
            if (data) {
                document.getElementById('detail-title').textContent = data.title;
                document.getElementById('detail-desc').textContent = data.desc;
                document.getElementById('detail-extra').textContent = data.extra;
            }
        }

        // --- SIMULATOR LOGIC ---

        let simStep = 0; // 0: Idle, 1: Material, 2: Vano, 3: Estanqueidad, 4: Post-Instalaci√≥n, 5: Finished
        const consoleDiv = document.getElementById('sim-console');
        const btnStart = document.getElementById('btn-start');
        const btnYes = document.getElementById('btn-yes');
        const btnNo = document.getElementById('btn-no');

        function logToConsole(text, type = 'info') {
            const p = document.createElement('div');
            p.textContent = `> ${text}`;
            p.className = "mb-1 " + (type === 'error' ? 'text-rose-400' : type === 'success' ? 'text-emerald-400' : type === 'warning' ? 'text-amber-400' : 'text-slate-300');
            consoleDiv.appendChild(p);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function toggleDecisionButtons(show) {
            btnStart.classList.toggle('hidden', show);
            btnYes.classList.toggle('hidden', !show);
            btnNo.classList.toggle('hidden', !show);
        }

        function promptDecision(question, step) {
            simStep = step;
            logToConsole(`\nüö® CHECKPOINT: ${question}`, 'warning');
            toggleDecisionButtons(true);
        }

        function startSimulation() {
            consoleDiv.innerHTML = `<div class="text-slate-500 border-b border-slate-700 pb-1 mb-2">Simulaci√≥n de Proceso de Instalaci√≥n Iniciada:</div>`;
            logToConsole("Paso 1: Recepci√≥n y verificaci√≥n de materiales.", 'info');
            setTimeout(() => promptDecision("Punto D1: ¬øLos materiales son Conformes?", 1), 1000);
        }

        function simDecision(isYes) {
            toggleDecisionButtons(false);
            
            if (simStep === 1) { // D1: ¬øMateriales Conformes?
                if (isYes) {
                    logToConsole("‚úÖ D1: Materiales APROBADOS. (Flujo S√ç)", 'success');
                    logToConsole("Paso 2: Preparaci√≥n del vano.", 'info');
                    setTimeout(() => promptDecision("Punto D2: ¬øEl vano est√° en condiciones para la instalaci√≥n?", 2), 1000);
                } else {
                    logToConsole("‚ùå D1: Materiales RECHAZADOS. (Flujo NO)", 'error');
                    logToConsole("‚Üí Registrar No Conformidad y Notificar a proveedor.", 'error');
                    setTimeout(() => {
                        logToConsole("‚Ü∫ Retroalimentaci√≥n: Se recibe nuevo material. Reanudando verificaci√≥n...", 'warning');
                        promptDecision("Punto D1: ¬øLos materiales son Conformes?", 1);
                    }, 2000);
                }
            } else if (simStep === 2) { // D2: ¬øVano en condiciones?
                if (isYes) {
                    logToConsole("‚úÖ D2: Vano en condiciones. (Flujo S√ç)", 'success');
                    logToConsole("Paso 3-6: Instalaci√≥n, Fijaci√≥n y Sellado perimetral.", 'info');
                    setTimeout(() => {
                        logToConsole("Paso 7: Prueba de estanqueidad iniciada...", 'info');
                        promptDecision("Punto D3: ¬øPasa la prueba de estanqueidad?", 3);
                    }, 2000);
                } else {
                    logToConsole("‚ùå D2: Vano NO en condiciones. (Flujo NO)", 'error');
                    logToConsole("‚Üí Reparar soporte y volver a verificar.", 'error');
                    setTimeout(() => promptDecision("Punto D2: ¬øEl vano est√° en condiciones para la instalaci√≥n?", 2), 1500);
                }
            } else if (simStep === 3) { // D3: ¬øPasa la prueba?
                if (isYes) {
                    logToConsole("‚úÖ D3: Prueba de estanqueidad APROBADA. (Flujo S√ç)", 'success');
                    logToConsole("Paso 8-9: Limpieza final y Verificaci√≥n Post-Instalaci√≥n (72h)...", 'info');
                    setTimeout(() => promptDecision("Punto D4: ¬øConforme a especificaciones (72h despu√©s)?", 4), 2000);
                } else {
                    logToConsole("‚ùå D3: Filtraciones detectadas. (Flujo NO)", 'error');
                    logToConsole("‚Üí Corregir filtraciones y repetir la prueba de estanqueidad.", 'error');
                    setTimeout(() => promptDecision("Punto D3: ¬øPasa la prueba de estanqueidad?", 3), 1500);
                }
            } else if (simStep === 4) { // D4: ¬øConforme a especificaciones?
                 if (isYes) {
                    logToConsole("‚úÖ D4: Instalaci√≥n 100% Conforme. (Flujo S√ç)", 'success');
                    logToConsole("Paso 10-11: Registro y Lecciones Aprendidas.", 'info');
                    logToConsole("üèÜ ¬°PROCESO COMPLETADO CON √âXITO!", 'success');
                    simStep = 5;
                    toggleDecisionButtons(false);
                    document.getElementById('btn-start').classList.remove('hidden');
                } else {
                    logToConsole("‚ùå D4: Desviaci√≥n o defecto post-instalaci√≥n. (Flujo NO)", 'error');
                    logToConsole("‚Üí Aplicar Acci√≥n Correctiva e integrar en Lecciones Aprendidas (Paso 11).", 'error');
                    logToConsole("üèÜ PROCESO FINALIZADO con Acci√≥n Correctiva Registrada.", 'success');
                    simStep = 5;
                    toggleDecisionButtons(false);
                    document.getElementById('btn-start').classList.remove('hidden');
                }
            }
        }


        // --- CHARTS LOGIC (Chart.js) ---

        let costChart, trendChart;

        function initCharts() {
            // Chart 1: Costo de la No Calidad (Bar)
            const ctx1 = document.getElementById('costChart').getContext('2d');
            costChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Falla Material', 'Falla Vano', 'Falla Estanqueidad', 'Falla Post-Instalaci√≥n'],
                    datasets: [{
                        label: 'Costo Relativo de Correcci√≥n (USD)',
                        data: [150, 200, 550, 1200], // Hypothetical data showing later fixes are exponentially more expensive
                        backgroundColor: ['#f59e0b', '#f97316', '#ef4444', '#b91c1c'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } },
                    plugins: { legend: { display: false } }
                }
            });

            // Chart 2: Tasa de Filtraciones (Line)
            const ctx2 = document.getElementById('leakageTrendChart').getContext('2d');
            trendChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['Mes 1', 'Mes 2', 'Mes 3', 'Mes 4', 'Mes 5', 'Mes 6'],
                    datasets: [{
                        label: '% de Aberturas que fallan D3',
                        data: [15, 12, 10, 7, 5, 4], // Showing a decrease due to 'Lecciones aprendidas' being implemented
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 20 } },
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            // Initial load of first detail panel
            showDetail(1);
        });

    </script>
</body>
</html>